<html>
    <head>
        <script type="text/javascript" src="lib/jquery-1.6.1.min.js"></script>
        <script type="text/javascript" src="lib/underscore.js"></script>

        <script type="text/javascript" src="src/Array.js"></script>
        <script type="text/javascript" src="src/Vector.js"></script>
        <script type="text/javascript" src="src/Node.js"></script>
        <script type="text/javascript" src="src/LocationRandomizer.js"></script>
        <script type="text/javascript" src="src/NodesCreator.js"></script>
        <script type="text/javascript" src="src/CoulombRepulsion.js"></script>
        <script type="text/javascript" src="src/HookeAttraction.js"></script>
        <script type="text/javascript" src="src/Forces.js"></script>
        <script type="text/javascript" src="src/ForceLocationCalculator.js"></script>

        <script type="text/javascript">
            var randomizer = locationRandomizer(600, 600, 410);
            var indexNodexCreator = nodesCreator(8, randomizer);
            var nodes = indexNodexCreator.createNodes();
            nodes[0].connectWith(nodes[1]);
            nodes[0].connectWith(nodes[2]);
            nodes[0].connectWith(nodes[3]);
            nodes[0].connectWith(nodes[4]);
            nodes[0].connectWith(nodes[5]);
            nodes[0].connectWith(nodes[6]);
            nodes[0].connectWith(nodes[7]);

            var repulsion = coulombRepulsion();
            var attraction = hookeAttraction();
            var nodeForces = forces(repulsion, attraction);
            var locationCalculator = forceLocationCalculator(nodeForces);
            $(document).ready(function() {
                    var canvas = $('#canvas')[0];
                    var context = canvas.getContext('2d');
                    drawNodes(nodes, context);
            });

            function drawNodes(nodes, context) {
                clearCanvas(canvas, context);
                for (var i=0; i<nodes.length; i++) {
                    nodes[i].draw(context);
                }
            }

            function updateLocation(nodes, context) {
                locationCalculator.updateLocationOf(nodes, vector(0, 0));
                drawNodes(nodes, context);
                setTimeout(callback, 100);
                function callback() {
                    updateLocation(nodes, context);
                };
            }

            function clearCanvas(canvas, context) {
                context.clearRect(0, 0, canvas.width, canvas.height);
                var width = canvas.width;
                canvas.width = 1;
                canvas.width = width;
            }
        </script>
    </head>
    <body>
        <canvas id="canvas" width="600" height="600"></canvas>
        <input type="submit" onclick="javascript:updateLocation(nodes, $('#canvas')[0].getContext('2d')); return false;" value="Iterate" />
    </body>
</html>
